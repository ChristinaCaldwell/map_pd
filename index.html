<html>
<head>
    <title>Population Density Map</title>
    <meta charset="utf-8" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<style>
    	#map {
		width: 100%;
		height: 100%;
		}
	</style>
</head>
<body>
  <div id="map"></div>
    <script>		
	var osmMap =
	L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',
	{
	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
	});	

	var map = L.map('map').setView([54.7, -6.75], 7);
	osmMap.addTo(map);

	var owsrootUrl = 'http://ec2-34-244-125-157.eu-west-1.compute.amazonaws.com:8080/geoserver/ows';

	var defaultParameters = {
    		service : 'WFS',
    		version : '2.0',
    		request : 'GetFeature',
    		typeName : 'pop_density:counties_popdensity',
    		outputFormat : 'text/javascript',
    		format_options : 'callback:getJson',
    		SrsName : 'EPSG:4326',
	};

	var parameters = L.Util.extend(defaultParameters);

	var URL = owsrootUrl + L.Util.getParamString(parameters);
    
//    var wmsLayer = L.tileLayer.wms('http://ec2-34-244-125-157.eu-west-1.compute.amazonaws.com:8080/geoserver/ows?', {
//        layers: 'pop_density:counties_popdensity',
//        transparent: true,
//        format: 'image/png'
//    }).addTo(map);

	
function getColor(d) {
    return d > 156 ? '#810f7c' :
           d > 83  ? '#8856a7' :
           d > 49  ? '#8c96c6' :
           d > 34  ? '#b3cde3' :
                     '#edf8fb' ;
}

	function popdenStyle(feature) {
	return {
		color: 'white',
		weight: 2,
		opacity: 1,
		fillOpacity: 0.7, 
		fillColor: getColor(feature.properties.pop_densit)
	};
	}
	
	var WFSLayer = null;

	$.ajax({
  	  url : URL,
	  dataType : 'jsonp',
    	  jsonpCallback : 'getJson',
    	  success : function (response) {
        	    WFSLayer = L.geoJson(response, {
            	style: popdenStyle,
           		onEachFeature: function (feature, layer) {
                    var att = feature.properties;
               		popupOptions = {maxWidth: 400};
               		layer.bindPopup("<b>County Name: </b>" + att.county +
				"<br><b>Population Density: </b>" + att.pop_densit, popupOptions);
          		}
        	    }).addTo(map);
    	}
	});	

    </script>
</body>	
</html>